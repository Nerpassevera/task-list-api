---
dist: focal
language: python
python:
  - "3.9"
services:
  - postgresql
addons:
  postgresql: "13"
env:
  global:
    - SQLALCHEMY_TEST_DATABASE_URI=postgresql+psycopg2://postgres@localhost:5432/task_list_api_test
before_install:
  - sudo apt-get update
  - sudo apt-get install -y postgresql-13 postgresql-client-13
before_script:
  - echo "Starting PostgreSQL..."
  - sudo sed -i 's/#port = 5432/port = 5432/'
    /etc/postgresql/13/main/postgresql.conf
  - sudo systemctl restart postgresql || sudo service postgresql start
  - psql --version
  - psql -c 'create database task_list_api_test;' -U postgres || true
  - psql -c '\l' -U postgres
install:
  - pip install -r requirements.txt
script:
  - pytest
after_success:
  - echo "Deploying to Render..."
  # - curl -X POST -H "Authorization: Bearer $RENDER_API_KEY "https://api.render.com/deploy/srv-csmrpdaj1k6c73dnhqi0?key=hVyereic-JM"
  - curl --location --request POST 'https://api.render.com/deploy/srv-csmrpdaj1k6c73dnhqi0?key=hVyereic-JM' --header 'Authorization: Bearer $RENDER_API_KEY'
# --header 'Cookie: __cf_bm=A4oQNGK8gQLyT.QHJYJ2jjze4pmrOLs4Wf3PiWRex.s-1732150898-1.0.1.1-rYYpXDUiddPWt.Q4H2ZvcNhc5FWuJ7UM3JdpJRUWLZ1wBRzUoVBvbCJeX5RHXkFeGmJyg6P.tGNu_ytkQlH5YQ'